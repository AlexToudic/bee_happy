function launch(){TweenMax.to("button",.5,{opacity:0,onComplete:function(){$("button").css({display:"none"}),$("body").css({cursor:"url(assets/images/fast.png), auto"})}}),animate(),play=!0,audio.play()}function finishedLoading(a){var b=context.createBufferSource();b.buffer=a[0],b.connect(context.destination),b.start(0)}function init(){audio=new Audio,audio.src="./assets/audio/Umbusy.mp3",audio.autoplay=!1,audio.loop=!1,audio.addEventListener("ended",function(){audio.currentTime=0,TweenMax.to(".veil",3,{height:"100%"})});var a=new webkitAudioContext;analyser=a.createAnalyser(),window.addEventListener("load",function(){var b=a.createMediaElementSource(audio);b.connect(analyser),analyser.connect(a.destination)},!1),container=document.getElementById("container"),scene=new THREE.Scene,config.camera.fov=70,config.camera.near=1,config.camera.far=1e4,config.camera.positionX=0,config.camera.positionY=20,config.camera.positionZ=0,camera=new THREE.PerspectiveCamera(config.camera.fov,window.innerWidth/window.innerHeight,config.camera.near,config.camera.far),camera.position.x=config.camera.positionX,camera.position.y=config.camera.positionY,camera.position.z=config.camera.positionZ,camera.rotation.x=-Math.PI/10;var b=new THREE.AmbientLight(1381653);scene.add(b);var c=new THREE.DirectionalLight(16777215,.5);c.position.set(0,1,0),scene.add(c),pointLight=new THREE.PointLight(1381653,10,100),pointLight.position.set(0,0,0),scene.add(pointLight),plane=new THREE.Mesh(new THREE.PlaneGeometry(5*window.innerWidth,4e3),new THREE.MeshLambertMaterial({color:0})),plane.rotation.x=-Math.PI/2,plane.material.side=THREE.DoubleSide,plane.position.x=0,plane.position.y=config.floor,plane.position.z=-300,scene.add(plane);for(var d=new THREE.PlaneGeometry(2500,4e3,256,1),e=255,f=256,g=["#ffd200","#be2d2d","#00b4ff","#39c318"],h=0,i=0;256>i;++i){var j=g[h++];h>3&&(h=0),materials.push(new THREE.MeshPhongMaterial({specular:j,color:j,emissive:j,shininess:1})),d.faces[e--].materialIndex=i,d.faces[f++].materialIndex=i}colorsTouch=new THREE.Mesh(d,new THREE.MeshFaceMaterial(materials)),colorsTouch.rotation.x=-Math.PI/2,colorsTouch.material.side=THREE.DoubleSide,colorsTouch.position.x=0,colorsTouch.position.y=config.floor+1,colorsTouch.position.z=-300,scene.add(colorsTouch);var k=new THREE.OBJLoader;k.load("./assets/3D/bee.obj",function(a){a=a.children[0],bee=a,bee.scale.set(.1,.1,.1),bee.position.x=0,bee.position.y=0,bee.position.z=200,bee.rotation.y=-Math.PI/2,bee.material=new THREE.MeshPhongMaterial({specular:8156416,color:8156416,emissive:8156416,shininess:1}),scene.add(bee),play&&animate()});var l=new THREE.OBJLoader;l.load("./assets/3D/flower.obj",function(a){a=a.children[0],flower=a,flower.scale.set(.05,.05,.05),play&&animate()});var m=new THREE.OBJLoader;m.load("./assets/3D/wing.obj",function(a){a=a.children[0],wings.right=a,wings.right.scale.set(.1,.1,.1),wings.right.position.x=0,wings.right.position.y=0,wings.right.position.z=200,wings.right.rotation.y=-Math.PI/2,wings.right.material=new THREE.MeshPhongMaterial({specular:16777215,color:16777215,emissive:16777215,shininess:1,transparent:!0}),wings.right.side=THREE.DoubleSide,wings.left=wings.right.clone(),wings.left.scale.set(wings.right.scale.x,wings.right.scale.y,-wings.right.scale.z),scene.add(wings.right),scene.add(wings.left),TweenMax.fromTo(wings.right.scale,.1,{y:wings.right.scale.y},{y:-wings.right.scale.y,repeat:-1}),TweenMax.fromTo(wings.left.scale,.1,{y:wings.left.scale.y},{y:-wings.left.scale.y,repeat:-1}),play&&animate()}),renderer=new THREE.WebGLRenderer,renderer.sortObjects=!1,renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement);var n=gui.addFolder("camera");n.add(config.camera,"positionX",-3e3,3e3).onChange(function(a){moveCamera=!1,camera.position.x=a}),n.add(config.camera,"positionY",-3e3,3e3).onChange(function(a){moveCamera=!1,camera.position.y=a}),n.add(config.camera,"positionZ",-3e3,3e3).onChange(function(a){moveCamera=!1,camera.position.z=a}),gui.add(config,"MAX_FLOWERS",0,1e3),gui.add(config,"BEE_SENSIBILITY",0,300),gui.add(config,"FLOWER_SENSIBILITY",0,300),gui.close(),window.addEventListener("resize",onWindowResize,!1),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("mousedown",function(){goFast=!0},!1),document.addEventListener("mouseup",function(){goFast=!1},!1)}function onDocumentMouseMove(a){mouseX=a.clientX-window.innerWidth/2,mouseY=a.clientY-window.innerHeight/2}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){if(bee&&flower&&wings.right){++frame,1==frame&&TweenMax.to(".veil",3,{height:"10%"});var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var b=0;b<flowerIn.length;++b)flowerIn[b].position.z>camera.position.z&&flowerOut.push(flowerIn.splice(b,1)[0]);for(var c=0;256>c;++c){if(materials[c].visible=a[c]>200,a[c]>config.BEE_SENSIBILITY&&c>20){var d=Math.random()>.5?a[c]:-a[c],e=Math.random()>.5?a[c]:-a[c];TweenMax.to(bee.position,.5,{x:bee.position.x+d/20,y:bee.position.y+e/20}),TweenMax.to(wings.right.position,.5,{x:wings.right.position.x+d/20,y:wings.right.position.y+e/20}),TweenMax.to(wings.left.position,.5,{x:wings.left.position.x+d/20,y:wings.left.position.y+e/20})}if(1==c%9&&(currentSum=0),currentSum+=a[c],flowerIn.length<config.MAX_FLOWERS&&0==c%9&&currentSum/10>config.FLOWER_SENSIBILITY){var f=flowerOut.splice(0,1)[0];if(!f){var g="#"+Math.floor(16777215*Math.random()).toString(16);f=new THREE.Mesh(flower.geometry,new THREE.MeshPhongMaterial({specular:g,color:g,emissive:g,shininess:1}))}f.scale.set(1e-8,1e-8,1e-8),f.position.x=bee.position.x+700*Math.random()-350,f.position.y=config.floor,f.position.z=bee.position.z-100*Math.random()-200;var h=Math.floor(((currentSum-config.FLOWER_SENSIBILITY)/10-100)/10)/50+.05;TweenMax.to(f.scale,.3,{x:h,y:h,z:h}),flowerIn.push(f),scene.add(f)}}requestAnimationFrame(animate),render()}}function render(){if(bee){if(!begin&&bee.position.z<=-100&&(begin=!0),(bee.position.x<-40||bee.position.x>40||bee.position.y<config.floor+10||bee.position.y>30)&&(TweenMax.to(bee.position,.3,{x:0,y:0}),TweenMax.to(wings.right.position,.3,{x:0,y:0}),TweenMax.to(wings.left.position,.3,{x:0,y:0})),beeFloat+=.1,bee.position.x+=Math.cos(beeFloat)/5,bee.position.y+=Math.sin(beeFloat)/5,wings.right.position.x+=Math.cos(beeFloat)/5,wings.right.position.y+=Math.sin(beeFloat)/5,wings.left.position.x+=Math.cos(beeFloat)/5,wings.left.position.y+=Math.sin(beeFloat)/5,goFast&&5>accelaration){++accelaration,config.camera.fov+=accelaration;var a={x:camera.position.x,y:camera.position.y,z:camera.position.z};camera=new THREE.PerspectiveCamera(config.camera.fov,window.innerWidth/window.innerHeight,config.camera.near,config.camera.far),camera.position.x=a.x,camera.position.y=a.y,camera.position.z=a.z,audio.playbackRate+=.3}else if(!goFast&&accelaration>1){--accelaration,config.camera.fov-=accelaration;var a={x:camera.position.x,y:camera.position.y,z:camera.position.z};camera=new THREE.PerspectiveCamera(config.camera.fov,window.innerWidth/window.innerHeight,config.camera.near,config.camera.far),camera.position.x=a.x,camera.position.y=a.y,camera.position.z=a.z,audio.playbackRate-=.3}else if(!goFast&&1==accelaration){config.camera.fov=70;var a={x:camera.position.x,y:camera.position.y,z:camera.position.z};camera=new THREE.PerspectiveCamera(config.camera.fov,window.innerWidth/window.innerHeight,config.camera.near,config.camera.far),camera.position.x=a.x,camera.position.y=a.y,camera.position.z=a.z,audio.playbackRate=1}begin&&moveCamera&&(camera.position.x+=.1*(bee.position.x-camera.position.x),camera.position.y+=.1*(bee.position.y+config.camera.positionY-camera.position.y),camera.position.z-=2*accelaration,camera.position.x+=.01*mouseX,camera.position.y+=.01*mouseY),$("#container").css({"background-position":-camera.position.y-camera.position.x}),bee.position.z-=2*accelaration,wings.right.position.z-=2*accelaration,wings.left.position.z-=2*accelaration,plane.position.z-=2*accelaration,colorsTouch.position.z-=2*accelaration,pointLight.position=camera.position,renderer.render(scene,camera)}}var play=!1,svg=d3.select("svg"),frame=0,audio,plane,colorsTouch,materials=[],accelaration=1,goFast=!1,begin=!1,flowerIn=[],flowerOut=[],config={};config.floor=-50,config.camera={},config.ambientLight={},config.FLOWER_SENSIBILITY=130,config.BEE_SENSIBILITY=200;var container,stats,camera,scene,projector,renderer,pointLight,moveCamera=!0,mouseX=0,mouseY=0,bee,flower,wings={};config.MAX_FLOWERS=20;var count=0,beeFloat=0,analyser,gui=new dat.GUI;init();var currentSum=0;